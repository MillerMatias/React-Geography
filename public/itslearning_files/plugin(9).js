CKEDITOR.plugins.add("longtouchcontextmenu",{requires:"contextmenu",beforeInit:function(c){if(CKEDITOR.env.iOS){var g=function(b,a){var c=!b.equals(CKEDITOR.document);b=b.getWindow().getScrollPosition();return{x:c?a.clientX:a.pageX||b.x+a.clientX,y:c?a.clientY:a.pageY||b.y+a.clientY}},h=c.config.longtouchcontextmenu,m=h.Delay,k=h.DistanceThreshold,l=new Date,d=null,e=!0,f=null;originalContextMenuOnClick=c.contextMenu._.onClick;c.contextMenu._.onClick=function(b){f&&c.getSelection().selectElement(f);
originalContextMenuOnClick(b)};c.on("contentDom",function(){var b=c.editable();b.on("touchstart",function(a){l=new Date;e=!1;d=g(a.data.getTarget().getDocument(),a.data.$.changedTouches[0])});b.on("touchend",function(a){if(!e&&new Date-l>=m){a=a.data;var b=a.getTarget().getDocument(),d=g(b,a.$.changedTouches[0]);f=CKEDITOR.dom.node(a.$.target);c.getSelection().selectElement(f);c.contextMenu.open(b.getDocumentElement(),null,d.x,d.y);setTimeout(function(){c.contextMenu._.panel.focus()},500)}});b.on("touchmove",
function(a){!e&&(a=g(a.data.getTarget().getDocument(),a.data.$.touches[0]),Math.abs(a.x-d.x)>k||Math.abs(a.y-d.y)>k)&&(e=!0)});b.on("touchcancel",function(){e=!0})})}}});
