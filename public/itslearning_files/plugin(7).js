CKEDITOR.plugins.add("itslimageprop",TextEditorManager.setupIframePlugin("itslimageprop",{dialogName:"itslimageprop_dialog",dialogSrcReplacementFunction:function(a,d,b){function g(b,a){if(a){var c=a.indexOf(b);if(0<=c)return c+=b.length,c=a.indexOf(":",c),a.substr(c+1,a.indexOf(";",c)-c-1).replace(" ","").replace("px","")}return""}a="src alt border align class width height".split(" ");b=b.getSelection();d=d.DialogSrc;if(!b||null==b.getSelectedElement())return null;var f=b.getSelectedElement().getAttribute("style"),
h;for(h in a){var c=a[h],e="";if("height"==c||"width"==c||"align"==c)e="align"==c?g("float",f):g(c,f);0==e.length&&((e=b.getSelectedElement().getAttribute(c))||(e=""));"src"==c&&0===e.lastIndexOf("data:",0)&&(e="data:");c="{"+c+"}";d=d.replace(c,encodeURIComponent(e));d=d.replace(new RegExp(encodeURIComponent(c),"i"),encodeURIComponent(encodeURIComponent(e)))}return d},beforeInitComplete:function(a,d){a.contextMenu&&(a.addMenuGroup("itslimageprop"),a.addMenuItem("itslimageprop",{label:d.EditText,
command:d.Id,group:"itslimageprop"}),a.contextMenu.addListener(function(b,a){(b=a?a.getSelectedElement():b)&&(b=b.getAscendant("img",!0));return!b||b.isReadOnly()||b.data("cke-realelement")?null:b.getAttribute("data-mathml")||b.getAttribute("plugincontent")||b.getAttribute("mediacontent")?null:{itslimageprop:CKEDITOR.TRISTATE_OFF}}))},dialogContentLoad:function(a,d,b){d=["data-image-date-limit","data-image-metadata"];a=a.getSelection();var g={};b=b.get(0);if(a&&null!=a.getSelectedElement()){a.getSelectedElement().getAttribute("style");
for(var f=0;f<d.length;f++){var h=d[f],c;(c=a.getSelectedElement().getAttribute(h))||(c="");g[h]=c}CommonFunctions.makePostMessageCall(b.contentWindow,new CommonWindowMessages.TextEditorSendImageSettingsMessage(g))}}}));
