var _info=navigator.userAgent,_mac=_info.indexOf("MAC");function PrepForJava(a){a=a.replace(/"/gi,"&#34;");return a=a.replace(/'/gi,"&#39;")}function GetNewEditorHeight(a){var b=0,c=null;null!=a.EditorDocument&&(c=a.EditorDocument);null==c?h=a.Config.DefaultHeight:c.height||window.opera?(b=15,h=scanElements(c.body,0,window.opera)):(b=15,h=c.body.scrollHeight);c=a.Config.MaxHeight;a=a.Config.MinHeight;h>c&&0!=c&&(h=c);h<a&&0!=a&&(h=a);return h+b}
function scanElements(a,b,c){!c&&a.offsetTop+a.offsetHeight>b&&(b=a.offsetTop+a.offsetHeight);for(c=0;c<a.childNodes.length;++c)b=scanElements(a.childNodes[c],b);return b}
function ToolbarAutoCollapse_OnComplete(a){if(a.Config.ToolbarAutoCollapse){ItslFckHelper.AddFckEditor(a.Name+"___Frame",a);a.Events.AttachEvent("OnBlur",ToolbarAutoCollapse_OnBlur,a);a.Events.AttachEvent("OnFocus",ToolbarAutoCollapse_OnFocus,a);var b=a.Config.AutoResizeOnInit,c=a.Config.ToolbarStartExpanded&&0>navigator.userAgent.toLowerCase().indexOf("msie");b&&SetEditorsHeightInARow(a,!1,c);a=GetEditorFrameElement(a);b=ItslFckHelper.EditorsArray[a.id];null!=b&&(b.InitialHeight=a.offsetHeight)}}
function ToolbarAutoCollapse_OnBlur(a){if(!a.Config.RowId)ToolbarCollapse(a);else if("undefined"!=typeof loadedEditors){for(var b=-1,c=0;c<loadedEditors.length;c++)loadedEditors[c]&&loadedEditors[c].HasFocus&&(b=c);if(-1==b||a.Config.RowId!=loadedEditors[b].Config.RowId)for(a=GetEditorsInOneRow(a),b=0;b<a.length;++b)ToolbarCollapse(a[b])}}function ToolbarAutoCollapse_OnFocus(a){if(a.Config.RowId){a=GetEditorsInOneRow(a);for(var b=0;b<a.length;++b)ToolbarExpand(a[b])}else ToolbarExpand(a)}
function GetEditorsInOneRow(a){var b=[];if("undefined"==typeof loadedEditors)return b;if(loadedEditors&&a.Config.RowId){for(var c=!1,d=0;d<loadedEditors.length;++d)loadedEditors[d].Config.RowId&&loadedEditors[d].Config.RowId==a.Config.RowId&&b.push(loadedEditors[d]),loadedEditors[d].Name==a.Name&&(c=!0);b.length&&c||b.push(a)}else b.push(a);return b}
function ToolbarCollapse(a){a.ToolbarSet.Collapse();a.Config&&a.Config.AutoResize&&SetEditorsHeightInARow(a,!1,!1);"undefined"!=typeof a.Config.CleanOnFocus&&ItslFckHelper.IsEditorEmpty(a)&&(a.EditorDocument.body.innerHTML=a.Config.Mask,a.Config.CleanOnFocus="1")}function ToolbarExpand(a){CleanDefaultText(a);a.ToolbarSet.Expand();ExtendElements(a,a.ToolbarSet._TargetElement.offsetHeight)}
function CleanDefaultText(a){var b=a.Config.CleanOnFocus;"undefined"!=typeof b&&"1"==b&&(a.Config.CleanOnFocus="0",ItslFckHelper.ClearInnerHTML(a))}function ExtendElements(a,b){if(a.Config.AutoResize){var c=GetEditorFrameElement(a),d=ItslFckHelper.EditorsArray[c.id];null!=d&&(c.style.height=d.InitialHeight+b+"px",ResetEditorTable(a,c))}}
function ResetEditorTable(a,b){b=b?b:GetEditorFrameElement(a);if(a=b.document?b.document.getElementById("xToolbarRow"):b.ownerDocument.getElementById("xToolbarRow"))if(a=a.parentNode.parentNode)a.style.height=b.document.body.offsetHeight+"px"}
function CalculateAndSetHeight(a,b){if(a.Config.AutoResize){var c=GetEditorFrameElement(a),d=ItslFckHelper.EditorsArray[c.id];if(null!=d){var g=a.Config.DefaultHeight,e=d.InitialHeight;ItslFckHelper.IsEditorEmpty(a)?(e=g,d.InitialHeight=e):b&&(e=GetNewEditorHeight(a),d.InitialHeight=e);c.style.height=e+"px";ResetEditorTable(a,c);return e}}}function CalculateEditorsHeightInARow(a,b){a=GetEditorsInOneRow(a);return CalculateEditorsHeight(a,b)}
function CalculateEditorsHeight(a,b){for(var c=0,d=0;d<a.length;++d){var g=a[d],e=GetEditorFrameElement(g),f=ItslFckHelper.EditorsArray[e.id];null!=f&&(e=g.Config.DefaultHeight,f=f.InitialHeight,ItslFckHelper.IsEditorEmpty(g)?f=e:b&&(f=GetNewEditorHeight(g)),f>c&&(c=f))}return c}
function SetEditorsHeightInARow(a,b,c){var d=GetEditorsInOneRow(a);a=a.ToolbarSet._TargetElement.offsetHeight;b||(b=CalculateEditorsHeight(d,!0));for(var g=0;g<d.length;++g){var e=d[g],f=GetEditorFrameElement(e),k=ItslFckHelper.EditorsArray[f.id];null!=f&&null!=k&&(c&&(b+=a),k.InitialHeight=b,f.style.height=b+"px",ResetEditorTable(e,f))}}function GetEditorFrameElement(a){return document.getElementById(a.Name+"___Frame")}
var ItslFckHelper={EditorsArray:[],AddFckEditor:function(a,b){if("undefined"!=typeof this.EditorsArray[a]&&null!=this.EditorsArray[a]){var c=this.EditorsArray[a];c.Instance=b}else c={Instance:b,InitialHeight:0};this.EditorsArray[a]=c},RemoveFckEditor:function(a){this.EditorsArray[a]=null;if("undefined"!=typeof loadedEditors&&"undefined"!=typeof totalEditors){instanceName=a.substring(0,a.length-8);for(a=0;a<loadedEditors.length;++a)if(loadedEditors[a]&&loadedEditors[a].Name==instanceName){loadedEditors.splice(a,
1);break}--totalEditors}},Initialize:function(){for(rootElementId in this.EditorsArray){var a=this.EditorsArray[rootElementId],b=document.getElementById(rootElementId);null!=b&&(a.InitialHeight=b.offsetHeight)}},IsEditorEmpty:function(a){var b=!0,c=ItslFckHelper.GetHTML(a);null!=c&&(c=c.toLowerCase(),(b=ItslFckHelper.IsEditorEmptyString(c))&&ItslFckHelper.ClearInnerHTML(a));return b},IsEditorEmptyString:function(a){return""==a||"<p>&nbsp;</p>"==a||'<p xmlns="http://www.imsglobal.org/xsd/imsqti_v2p1">&nbsp;</p>'==
a||"<div>&nbsp;</div>"==a||"<p>&#160;</p>"==a||"<p></p>"==a?!0:!1},GetHTML:function(a){var b=a.GetHTML();ItslFckHelper.IsEditorEmptyString(b)&&-1<navigator.userAgent.toLowerCase().indexOf("gecko/")&&(a.EditorDocument.body.innerHTML='<p><br type="_moz" /></p>');return b},ClearInnerHTML:function(a){-1<navigator.userAgent.toLowerCase().indexOf("gecko/")?a.EditorDocument.body.innerHTML='<p><br type="_moz" /></p>':a.EditorDocument.body.innerHTML=""},SetFocus:function(a){a.Config.IsFocused&&(a.Config.IsFocused=
!1,a.Focus(),a.EditorWindow.focus())}};function SetTabindex_OnComplete(a){var b=document.getElementById(a.Name+"___Frame");a=a.Config.TabIndex;0<=a&&null!=b&&(b.tabIndex=a)}function SetFocus_OnComplete(a){if("undefined"!=typeof loadedEditors&&"undefined"!=typeof totalEditors){if(loadedEditors.length==totalEditors)for(a=0;a<totalEditors;a++)ItslFckHelper.SetFocus(loadedEditors[a])}else ItslFckHelper.SetFocus(a)};
