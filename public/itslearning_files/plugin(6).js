var _wrs_int_conf_file="https://applications.itslearning.com/wiris";-1==_wrs_int_conf_file.indexOf("/",_wrs_int_conf_file.length-1)&&(_wrs_int_conf_file+="/");_wrs_int_conf_file+="integration/configurationjs.aspx";var _wrs_int_conf_async=!1,_wrs_conf_path=CKEDITOR.basePath+"plugins/ckeditor_wiris",_wrs_conf_editor="CKEditor4",_wrs_int_path=_wrs_int_conf_file.split("/");_wrs_int_path.pop();_wrs_int_path=_wrs_int_path.join("/");
_wrs_int_path=0==_wrs_int_path.indexOf("/")||0==_wrs_int_path.indexOf("http")?_wrs_int_path:_wrs_conf_path+"/"+_wrs_int_path;var _wrs_conf_setSize=!1,_wrs_error_loading=!1;
try{var httpRequest="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),configUrl=0==_wrs_int_conf_file.indexOf("/")||0==_wrs_int_conf_file.indexOf("http")?_wrs_int_conf_file:_wrs_conf_path+"/"+_wrs_int_conf_file;httpRequest.open("GET",configUrl,_wrs_int_conf_async);httpRequest.send(null);eval(httpRequest.responseText);var script=document.createElement("script");script.type="text/javascript";script.src=_wrs_conf_path+"/core/core.js";document.getElementsByTagName("head")[0].appendChild(script)}catch(a){_wrs_error_loading=
!0}var _wrs_int_editorIcon=CKEDITOR.basePath+"/plugins/ckeditor_wiris/core/icons/equation16.png",_wrs_int_CASIcon=CKEDITOR.basePath+"/plugins/ckeditor_wiris/core/icons/cas.gif",_wrs_int_temporalElement,_wrs_int_temporalElementIsIframe,_wrs_int_window,_wrs_int_window_opened=!1,_wrs_int_temporalImageResizing,_wrs_int_wirisProperties,_wrs_int_directionality,_wrs_int_disableDoubleClick=!1,_wrs_itsl_setData_shouldPreventLoop=!1,_wrs_conf_itsl_kpiUrl;
CKEDITOR.plugins.add("ckeditor_wiris",{init:function(a){function c(){window.wrs_initParse&&"undefined"!=typeof _wrs_conf_configuration_loaded&&null!=h?a.setData(wrs_initParse(h),function(){var b=!1;a.on("beforeSetMode",function(a){b=!0});a.on("mode",function(a){b=!1});a.on("getData",function(a){b||(a.data.dataValue=wrs_endParse(a.data.dataValue))});a.on("setData",function(b){_wrs_itsl_setData_shouldPreventLoop?_wrs_itsl_setData_shouldPreventLoop=!1:(_wrs_itsl_setData_shouldPreventLoop=!0,a.setData(wrs_initParse(b.data.dataValue)))});
setInterval(function(){try{divIframe=!1;var b=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.$:(document.getElementById("cke_contents_"+a.name)?document.getElementById("cke_contents_"+a.name):document.getElementById("cke_"+a.name)).getElementsByTagName("iframe")[0];b||(b=document.getElementById("cke_contents_"+a.name)?document.getElementById("cke_contents_"+a.name):document.getElementById("cke_"+a.name),divIframe=!0);if(b.wirisActive)b.contentWindow&&!b.contentWindow.document.firstChild.wirisActive&&
(wrs_addIframeEvents(b,function(b,c,e){wrs_int_doubleClickHandlerForIframe(a,b,c,e)},wrs_int_mousedownHandler,wrs_int_mouseupHandler),b.contentWindow.document.firstChild.wirisActive=!0);else if(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE){if("TEXTAREA"==b.tagName){var c=document.getElementsByClassName("cke_textarea_inline");Array.prototype.forEach.call(c,function(b){wrs_addElementEvents(b,function(b,c,e){wrs_int_doubleClickHandlerForDiv(a,b,c,e)},wrs_int_mousedownHandler,wrs_int_mouseupHandler)})}else wrs_addElementEvents(b,
function(b,c,e){wrs_int_doubleClickHandlerForDiv(a,b,c,e)},wrs_int_mousedownHandler,wrs_int_mouseupHandler);b.wirisActive=!0;g=b}else null!=b.contentWindow?(wrs_addIframeEvents(b,function(b,c,e){wrs_int_doubleClickHandlerForIframe(a,b,c,e)},wrs_int_mousedownHandler,wrs_int_mouseupHandler),b.wirisActive=!0,b.contentWindow.document.firstChild.wirisActive=!0,g=b):divIframe&&(wrs_addElementEvents(b,function(b,c,e){wrs_int_doubleClickHandlerForDiv(a,b,c,e)},wrs_int_mousedownHandler,wrs_int_mouseupHandler),
b.wirisActive=!0,g=b)}catch(k){}},500)}):setTimeout(c,50)}if(_wrs_error_loading)return!1;if(4>parseFloat(CKEDITOR.version)){var b="toolbar_"+a.config.toolbar;if(CKEDITOR.config[b])for(var d=!1,f=0;f<CKEDITOR.config[b].length;++f)"wiris"==CKEDITOR.config[b][f].name&&(d?(CKEDITOR.config[b].splice(f,1),f--):d=!0)}_wrs_int_directionality=a.config.contentsLangDirection;_wrs_conf_itsl_kpiUrl=a.config.ckeditor_wiris.DialogSrc;var h=null;a.once("dataReady",function(b){h=a.getData()});a.on("doubleclick",function(a){if("img"==
a.data.element.$.nodeName.toLowerCase()&&wrs_containsClass(a.data.element.$,_wrs_conf_imageClassName)||wrs_containsClass(a.data.element.$,_wrs_conf_CASClassName))a.data.dialog=null});var g=null;c();_wrs_conf_editorEnabled&&(b="img[align,"+_wrs_conf_imageMathmlAttribute+",src,alt](!Wirisformula)",a.addMenuGroup("ckeditor_wiris"),a.addMenuItem("ckeditor_wiris",{label:a.config.ckeditor_wiris.EditText||"Edit equation",icon:_wrs_int_editorIcon,command:"ckeditor_wiris_openFormulaEditor",group:"ckeditor_wiris"}),
a.addCommand("ckeditor_wiris_openFormulaEditor",{async:!1,canUndo:!0,editorFocus:!0,allowedContent:b,requiredContent:b,exec:function(a){wrs_int_openNewFormulaEditor(g,wiris_transform_lang(a.langCode),a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&!divIframe)}}),b=a.config.ckeditor_wiris.Text||"WIRIS editor",a.ui.addButton("ckeditor_wiris_formulaEditor",{label:b,command:"ckeditor_wiris_openFormulaEditor",icon:_wrs_int_editorIcon}),a.contextMenu.addListener(function(a,b){(a=b?b.getSelectedElement():a)&&
(a=a.getAscendant("img",!0));return!a||a.isReadOnly()||a.data("cke-realelement")||null==a.getAttribute("data-mathml")?null:{ckeditor_wiris:CKEDITOR.TRISTATE_OFF}}),_wrs_int_wirisProperties={},_wrs_int_wirisProperties.title=b,"wirisimagecolor"in a.config&&(_wrs_int_wirisProperties.color=a.config.wirisimagecolor),"wirisimagebgcolor"in a.config&&(_wrs_int_wirisProperties.bgColor=a.config.wirisimagebgcolor),"wirisbackgroundcolor"in a.config&&(_wrs_int_wirisProperties.backgroundColor=a.config.wirisbackgroundcolor),
"wirisimagesymbolcolor"in a.config&&(_wrs_int_wirisProperties.symbolColor=a.config.wirisimagesymbolcolor),"wirisimagenumbercolor"in a.config&&(_wrs_int_wirisProperties.numberColor=a.config.wirisimagenumbercolor),"wirisimageidentcolor"in a.config&&(_wrs_int_wirisProperties.identColor=a.config.wirisimageidentcolor),"wiristransparency"in a.config&&(_wrs_int_wirisProperties.transparency=a.config.wiristransparency),"wirisimagefontsize"in a.config&&(_wrs_int_wirisProperties.fontSize=a.config.wirisimagefontsize),
"wirisdpi"in a.config&&(_wrs_int_wirisProperties.dpi=a.config.wirisdpi));_wrs_conf_CASEnabled&&(b="img[width,height,align,src,"+_wrs_conf_CASMathmlAttribute+"](!Wiriscas); ",b+="applet[width,height,align,code,archive,codebase,alt,src](!Wiriscas); param[name,value]",a.addCommand("ckeditor_wiris_openCAS",{async:!1,canUndo:!0,editorFocus:!0,allowedContent:b,requiredContent:b,exec:function(a){wrs_int_openNewCAS(g,a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&!divIframe,wiris_transform_lang(a.langCode))}}),
a.ui.addButton("ckeditor_wiris_CAS",{label:"WIRIS cas",command:"ckeditor_wiris_openCAS",icon:_wrs_int_CASIcon}))}});function wrs_int_openNewFormulaEditor(a,c,b){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_isNewElement=_wrs_int_window_opened=!0,_wrs_int_temporalElement=a,_wrs_int_temporalElementIsIframe=b,_wrs_int_window=wrs_openEditorWindow(c,a,b))}
function wrs_int_openNewCAS(a,c,b){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_isNewElement=_wrs_int_window_opened=!0,_wrs_int_temporalElement=a,_wrs_int_temporalElementIsIframe=c,_wrs_int_window=wrs_openCASWindow(a,c,b))}function wrs_int_doubleClickHandlerForDiv(a,c,b,d){wrs_int_doubleClickHandler(a,c,!1,b,d)}function wrs_int_doubleClickHandlerForIframe(a,c,b,d){wrs_int_doubleClickHandler(a,c,!0,b,d)}
function wrs_int_doubleClickHandler(a,c,b,d,f){"img"==d.nodeName.toLowerCase()&&(wrs_containsClass(d,_wrs_conf_imageClassName)?_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_temporalImage=d,wrs_int_openExistingFormulaEditor(c,b,wiris_transform_lang(a.langCode))):wrs_containsClass(d,_wrs_conf_CASClassName)&&(_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_temporalImage=d,wrs_int_openExistingCAS(c,b,wiris_transform_lang(a.langCode)))))}
function wrs_int_openExistingFormulaEditor(a,c,b){_wrs_int_window_opened=!0;_wrs_isNewElement=!1;_wrs_int_temporalElement=a;_wrs_int_temporalElementIsIframe=c;_wrs_int_window=wrs_openEditorWindow(b,a,c)}function wrs_int_openExistingCAS(a,c,b){_wrs_int_window_opened=!0;_wrs_isNewElement=!1;_wrs_int_temporalElement=a;_wrs_int_temporalElementIsIframe=c;_wrs_int_window=wrs_openCASWindow(a,c,b)}
function wrs_int_mousedownHandler(a,c){"img"==c.nodeName.toLowerCase()&&(wrs_containsClass(c,"Wirisformula")||wrs_containsClass(c,"Wiriscas"))&&(_wrs_int_temporalImageResizing=c)}function wrs_int_mouseupHandler(){_wrs_int_temporalImageResizing&&setTimeout(function(){wrs_fixAfterResize(_wrs_int_temporalImageResizing)},10)}
function wrs_int_updateFormula(a,c,b){_wrs_int_temporalElementIsIframe?wrs_updateFormula(_wrs_int_temporalElement.contentWindow,_wrs_int_temporalElement.contentWindow,a,_wrs_int_wirisProperties,c,b):wrs_updateFormula(_wrs_int_temporalElement,window,a,_wrs_int_wirisProperties,c,b)}
function wrs_int_updateCAS(a,c,b,d){_wrs_int_temporalElementIsIframe?wrs_updateCAS(_wrs_int_temporalElement.contentWindow,_wrs_int_temporalElement.contentWindow,a,c,b,d):wrs_updateCAS(_wrs_int_temporalElement,window,a,c,b,d)}function wrs_int_notifyWindowClosed(){_wrs_int_window_opened=!1}function wiris_transform_lang(a){a=a.toLowerCase();return"en-gb"==a||"en-us"==a?"en":"nn-no"==a||"nb"==a?"no":"co"==a?"fr":"lt"==a?"en":"pt-br"==a?"pt_br":a};
